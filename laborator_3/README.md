# Лабораторная работа Nr.3: Работа с облачными сетями.
## 1. Постановка задачи, цель и этапы работы
**1.1** Необходимо подемонстрировать как работать с облачными сетями, создать VPC и реализовать bation который помогает работать с защищеными путями.
<br>
**1.2** Этапы реализации
<br>
**1.2.1** Создание VPC
<br>
**1.2.2** Создание IGW
<br>
**1.2.3** Создание подсети
<br>
**1.2.4** Создание Публичной подсети
<br>
**1.2.5** Создание приватной подсети
<br>
**1.2.6** Создание таблицы маршутов**
<br>
**1.2.7** Создание NGW и Elastic IP
<br>
**1.2.8** Создание Security Group
<br>
**1.2.9** создание EC2 и тестирование
<br>
**1.3.0** Реализация Bastion Host **[Advanced]**
<br>

## Практическая часть лабораторной
## 1. Подготовка к выполению
1.1 Необходимо зайти в свой аккаунт AWS, затем перейти к созданию VPC

## 2. Создание VPC

После перехода в **VPC** необходимо выбрать **Your VPC -> Create VPC**  
![CreateVPC](https://i.imgur.com/f7MOJ3u.png)

### 2.1 Заполнение данных

**Name tag:** `student-vpc-k7`
(В моем случае 7)  
**IPv4 CIDR block:** `10.(k%30).0.0/16`  
- Пример:  
  - если `k = 12`, используйте `10.12.0.0/16`  
  - если `k = 31`, используйте `10.1.0.0/16`

**Tenancy:** `Default`

---

### 2.2 Дальнейшие шаги

1. Нажимаем **Create VPC**.
2. Необходимо убедится, что VPC создана и имеет указанный CIDR.
![workVPC](https://i.imgur.com/3W7KZzi.png)

## 3. Создание IGW

IGW - Internet Gateway необходим для доступа в интернет, публичные IP не смогут работать без него

---
### 3.1 Создание IGM

![createIGW](https://i.imgur.com/H64hARu.png)
Необходимо указать название, и нажать на кнопку create Internet Gateway
У нас появился Internet Gateway, и его необходимо привязать к VPC

---
### 3.2 Привязка IGW к VPC
---

Для этого, выбрать недавно созданный IGW и нажать action -> attach VPC
![attachVPC1](https://i.imgur.com/kVXBekF.png)
После необходимо выбрать созданный VPC и нажать Attach Internet Gateway
![attachVPC2](https://i.imgur.com/C9pNH2u.png)

---
## 4. Создание подсетей
Подсети необходимы для того, чтоб изолировать сегменты внутри VPC, то есть чтоб их разделить
---

### 4.1 Создания публичной подсети
Это необходимо для того, чтоб любой мог к ней подключится, в дальнейшем создает еще и приватная, к которой будет доступ только, через публичную

Для этого, создаем subnet, и вводим данные.
1. Выбирать созданный VPC
2. Ввести название public-subnet-k7 
3. Выбрать зону доступности - central в данном случае
4. Генерация айпи адреса для нее в данном случае /24
![createPublicSubnet](https://i.imgur.com/CwAtGgS.png)
---
### 4.2 Создание приватной подсети
Подсеть называется приватной, если её трафик не направляется напрямую в Интернет.

Для этого, создаем subnet, и вводим данные.
1. Выбирать созданный VPC
2. Ввести название private-subnet-k7 
3. Выбрать зону доступности - любую другую
4. Генерация айпи адреса для нее в данном случае /24
![createPublicSubnet](https://i.imgur.com/XI2DuSu.png)

---


## 5. Создание маршутов
Необходимо для того, чтоб понимать что и как может делать созданая подсеть
### 5.1 Создание публичной таблицы
Для этого зайти в route table -> create route table
![routeTable](https://i.imgur.com/LXECpP6.png)
нажать add route выбрать 0.0.0.0/0 что означает что любой айпи может пользоваться
Дальше ассоцируем нашу таблицу с подсетью для того, чтоб она могла выходить в интеренет
![assocSubnet](https://i.imgur.com/clN5CwP.png)
### 5.2 Создание приватной таблицы
Для этого зайти в route table -> create route table
![routeTable](https://i.imgur.com/hLT6wJR.png)
Тут не нужно указывать роут, так как это приватная сеть и в нее доступ из вне запрещен
Дальше ассоцируем нашу таблицу с подсетью для того, чтоб она могла выходить в интеренет
![assocSubnet](https://i.imgur.com/uYt4VEy.png)

## 6. Создание NAT
### 6.1 Создание Elastic IP
Он создан для того, чтоб приватный инстанс смог выходить в сеть, но под другим айпи адресом он его просто меняет
![EiP](https://i.imgur.com/fcOrYx4.png)
### 6.2 Создания NAT
Для этого переходим в NAT gateway затем создаем
![CreateNAT](https://i.imgur.com/WDf2VVd.png)
Выбираем нашу приватную под сеть, и созданный Elastic IP, что позволит приватному инстансу выходить в сеть
### 6.3 Изменение приватной таблицы маршутов
Для этого переходим в route tables выбрать созданую приватную таблицу, затем edit route и выбрать следующие параметры
![editPrivatTable](https://i.imgur.com/KWkBguJ.png)

## 7. Создания Security Group
Необходимо создать несколько групп, для работы с инстансами

### 7.1 Создание группы для веб-сервера
![sgWeb](https://i.imgur.com/7GFiP7k.png)
### 7.2 Создание группы для Bastion-host
![bastionSG](https://i.imgur.com/vl5VqMp.png)
**Примечание:** в source выбрать myIP я не выбрал в целях безопасности скриншота
### 7.3 Создание группы для DataBase
![sgDB](https://i.imgur.com/Enyowug.png)


## 8. Созданиае Instaces
Полный гайд установки можно найти на прошлой странице
### 8.1 Инстанс веб-сервера
![wbEC](https://i.imgur.com/okgdKSZ.png)
### 8.2 Инстанс бастион
![dbEC](https://i.imgur.com/RCz5Dfz.png)
### 8.3 Инстанс базы-данных
![bastEC](https://i.imgur.com/wqRiN2g.png)


## 9. Проверка работы
### 9.1 Проверка web-instance
![ws](https://i.imgur.com/x8L0BvL.png)
После перехода по ссылке публичного айпи мы видим данный сайт
### 9.2 Проверка bastion host
![bh](https://i.imgur.com/8ux14Ne.png)
Пинг прошел успешно, что означает bastion host имеет доступ к интернету
### 9.3 Проверка базы даннных
![db](https://i.imgur.com/lUEsQJZ.png)
необходимол ввести пароль который мы указали в скрипте когда инициализировали инстанс

Все тесты прошли успешно, что означает, что структура облака работает хорошо, и как требуется.

# Контрольные вопросы
- Маска `/16` означает, что первые 16 бит IP-адреса фиксированы для сети, а оставшиеся 16 бит для хостов.  
- Почему нельзя использовать `/8`?  
  - `/8` дает слишком большую сеть
  - AWS накладывает ограничения на большие диапазоны для приватных VPC, чтобы не расходовать адресное пространство.

- Является ли подсеть "публичной" на данный момент? Почему?
  - Нет, так как у нее еще нет маршута в интернет черезе Internet Gateway, даже если и публичный IP, они все равно не имеют доступ

- Является ли подсеть "приватной" на данный момент? Почему?
  - Да, на данный момент подсеть приватная, потому что нет маршрута через Internet Gateway. Ресурсы внутри неё не могут напрямую выходить в Интернет, даже если у них есть публичный IP.

- Как работает NAT Gateway?
  - Можно сказать это роутер который помогает приватной подсети выходит в сеть под elastic ip, он дает доступ к сети меняя айпи адрес, но запросы он не принимает

- Что такое Bastion Host и зачем он нужен в архитектуре с приватными подсетями?
  - Bastion в архитектуре VPC можно сказать пост. Через него администратор попадает внутрь приватной сети, не открывая прямой доступ из интернета.

# Источники:
1. moodle.com - CCRu - [https://elearning.usm.md/mod/assign/view.php?id=316713] - Nichita Nartea
2. timeweb - Cоздание базового VPC - [https://timeweb.cloud/tutorials/cloud/sozdaniye-bazovogo-vpc-i-komponenty-v-aws] - web-page

# Дополнительные данные
Все скриншоты с работы - [Сюда](https://imgur.com/a/aBxSG5q)