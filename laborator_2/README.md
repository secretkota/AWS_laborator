# Лабораторная работа по AWS №2
## Описание лабораторной работы

**Цель лабораторной работы** — работа с основными сервисами AWS, такими как IAM, EC2, Billing, и научиться развёртывать веб-приложение на виртуальной машине Amazon EC2.  

**В процессе работы изучаются** - управление пользователями и правами, настройка бюджета, запуск виртуальных машин, установка и конфигурация веб-сервера, мониторинг и логирование.


## Постановка задачи
1. Создать IAM группу и пользователя с правами администратора.
2. Настроить уведомления о расходах с помощью Zero-Spend Budget.
3. Развернуть EC2 инстанс с Amazon Linux и веб-сервером Nginx.
4. Настроить мониторинг и логирование инстанса.
5. Подключиться к EC2 по SSH.
6. Развернуть статический сайт или PHP-приложение (в зависимости от специализации).
7. Остановить инстанс после выполнения лабораторной работы.

## Цель и основные этапы работы
1. Получить навыки работы с IAM (управление пользователями и группами).
2. Настроить контроль расходов в AWS.
3. Запустить виртуальную машину и установить веб-сервер.
4. Настроить мониторинг и логирование.
5. Развернуть веб-сайт (HTML или PHP).
6. Изучить взаимодействие EC2 с Docker (для DevOps).



## Практическая часть.
`Важно! 0,1,2 не обязательно загружить в readme`

3. Создание и запуск EC2 экземпляра (виртуальной машины)
<br>
3.1 Необходимо открыть нужный пункт в интерфейсе AWS который отвечает за    Instances, в данном случае необходим EC2
![Интерфейс EC2](https://i.imgur.com/mgmjG21.png)
3.2 Нужно нажать на launch instances, после чего начать вводить нужные данные в формую.
<br>
3.3 Нужно ввести данные о машине, какая операционная система будет, и дополнительные пункты в данном случае будет введен bash который обновит машину и установит nginx
![11](https://i.imgur.com/ht50HG5.png)
3.4 Посе ввода данных, появляется окно в котором виден прогрес инициализации виртаульно машины ![22](https://i.imgur.com/4mVMZ1p.png)

к 3 пункту, что было произведено после 3.3
```bash
1. Запуск нового инстанса EC2 через консоль:
- Name: webserver
- AMI: Amazon Linux 2023
- Instance type: t3.micro
- Key pair: создаем новый covaliuc_stas-keypair.pem
- Security group: webserver-sg
HTTP  — любой IP
SSH — только ваш IP
Network settings и Storage оставляем по умолчанию
2. В Advanced details → User Data вставляем скрипт:
#!/bin/bash
dnf -y update             # Обновляем все пакеты
dnf -y install htop       # Устанавливаем утилиту мониторинга процессов
dnf -y install nginx      # Устанавливаем веб-сервер Nginx
systemctl enable nginx    # Включаем автозапуск Nginx при старте системы
systemctl start nginx     # Запускаем Nginx сразу после старта инстанса
3. После запуска инстанса ждём статуса Running и Status checks: 2/2
```

Виртуальная машина успешно создалась:
![33](https://i.imgur.com/9TZJi3x.png)

Перейдя по публичному айпи мы видим
![333](https://i.imgur.com/bdBvqHG.png)
Подключившись при помощи SSH мы видем:
![333](https://i.imgur.com/ibxPPM0.png)


### 4. Логирование и мониторинг
4.1 Просмотр состояния instance, в данном случае все 3 проверки прошли успешно, значит ошибок на instance нет.
![444](https://i.imgur.com/CnBg6um.png)
4.2 Просмотр как выглядит наша система, для этого в actions мы можем выбрать пункт monitor and trobleshoot -> Get instances screnhoot
![444](https://i.imgur.com/JLLvBs2.png)
4.3 Просмотр системны логов, для этого необходимо запросить в том же меню пункт Get System log
(В целях безопасности, будет продемонстрировано на паре по CLOUD)

### 5. Подключение по SSH (windows)
5.1 Для подключения к instance надо использовать keypair который был создан и скачан при создании instance, в нем храниться: 
<br>
5.1.1 Приватный ключ который показывает, что подключается владелец данного облака
5.2 После запуска instance для того, чтоб подключиться по SSH необходимо использовать команду
```ssh -i yornickname-keypair.pem ec2-user@public-ip```
после подключения мы видим нашу среду, если использовать команду htop она должна выполниться
![333](https://i.imgur.com/ibxPPM0.png)

### 6b Добавления проекта на PHP
Для загрузки проекта на сервер был использоан FilleZilla, это FTP клиент для подключения к серверу
6.1 Для начала необходимо создать в нем Менеджер сайтов для подключения к серверу (Данный способ помогает ускорить процесс при нажатии только кнопки)
![666](https://i.imgur.com/gBD45ji.png)
6.2 После подключения кидаю папку с php кодом в home (cделано в целях безопасности) дальше переношу код в etc/nginx `/usr/share/nginx/html` 
6.3 Нужно установить скрипты nginx, php-fpm и php для работы с файлами
команда:
```bash
sudo dnf -y install nginx php php-fpm
sudo systemctl enable nginx
sudo systemctl start nginx
sudo systemctl enable php-fpm
sudo systemctl start php-fpm
```
6.4 Создается конфигурационный файл, для работы с сервером (возможностью подключатся с 80 порта http)
```bash
server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.php index.html index.htm;

  location / {
      try_files $uri $uri/ =404;
  }

  location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/run/php-fpm/www.sock;
  }

  location ~ /\.ht {
      deny all;
  }
}
```
6.4.1 Конфиг загружается по пути ```/etc/nginx/conf.d/```
6.5 Проверка работоспособности сайта


### Контрольные вопросы:
## Что делает данная политика? AdministratorAccess
Данная политка дает созданому сервису IAM доступ администратора к сервису, то есть полный доступ

## Что такое User Data и какую роль выполняет данный скрипт? Для чего используется nginx?
**Userdata** - это просто скрипт который выполняется при инициализации instance, в скрипте часто пишут популярные действия чтоб не повторять это вручную например обновление данных или установка программ для сервера
<br>
**nginx** - Программа которая помогает сделать сервер, проще говоря HTTP web server

## В каких случаях важно включать детализированный мониторинг?
Важно включать когда на облаке хранится проект, который очень важен, и для того чтоб быстрее отследить где произошел сбой (например популярный сервис какой нибудь как twitch)
## Почему в AWS нельзя использовать пароль для входа по SSH?
Пароли можно использовать, но это не безопасно, так же AWS никогда не хранит приватный пароль, поэтому необходимо использовать ключ который создает AWS при инициализации instance
## Что делает данный конфигурационный файл? myservr conf
Данный файл помогает подлючатся с 80 порта http, также он говорит где находится нужный файл, например index.php для захода в проект, так же запрещает доступ к htaccess где могут хранится парооли и данные
### Список использованных источников
1. Cloud Computing - https://elearning.usm.md/mod/assign/view.php?id=315493 - Nichita Nartea
